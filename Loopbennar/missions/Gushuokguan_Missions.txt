#Gushuokguan Mission Tree - Ideated by: Memegraaf
#							Coded by: Meander

gushuokguan_1 = {
	slot = 1
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = Y17 } 

	gushuokguan_1_2 = {
		icon = mission_a_million_rice_fields
		position = 2
		required_missions = { gushuokguan_2_1 } 
		provinces_to_highlight = {  } 

		trigger = {
			num_of_owned_provinces_with = {
				OR = {
					has_production_building_trigger = yes
					is_prosperous = yes
					development = 8
				}
				value = 15
			}
		}

		effect = {  
			add_country_modifier = {
				name = gushuokguan_economic_buff
				duration = 7300
			}
			custom_tooltip = gushuokguan_immigration_events_tt
			random_list = {
				1 = { country_event = { id = gushuokguan_event.11 } } #Migrants come to X
				1 = { country_event = { id = gushuokguan_event.12 } } #Migrant Clash in X
				1 = { country_event = { id = gushuokguan_event.13 } } #Migrants Clash with Locals
				1 = { country_event = { id = gushuokguan_event.14 } } #Migrants Thrive
				1 = { country_event = { id = gushuokguan_event.15 } } #Stronger Together
				1 = { country_event = { id = gushuokguan_event.16 } } #Migratory Mercenaries
			}
			hidden_effect = {
				set_country_flag = gushuokguan_enable_migration_events
				country_event = { id = gushuokguan_event.21 days = 18250 } #Clear the flag
			}
		} 
	}

	gushuokguan_1_3 = {
		icon = mission_son_own_develop_clothes_and_salt
		position = 3
		required_missions = { gushuokguan_1_2 } 
		provinces_to_highlight = {  
			owned_by = ROOT #Gushuokguan
			OR = {
				trade_goods = grain
				trade_goods = livestock
				trade_goods = fish
			}
			NOT = {
				AND = {
					has_production_building_trigger = yes
					has_manpower_building_trigger = yes
					has_manufactory_trigger = yes
					base_production = 7
				}
			}
		} 

		trigger = {
			num_of_owned_provinces_with = {
				OR = {
					trade_goods = grain
					trade_goods = livestock
					trade_goods = fish
				}
				has_production_building_trigger = yes
				has_manpower_building_trigger = yes
				has_manufactory_trigger = yes
				base_production = 7
				value = 15
			}
		}

		effect = {  
			for = {
				amount = 5 #Cursed indentation, because strings like these are max 512 characters
				effect = " 
random_owned_province = {
limit = {
OR = {
trade_goods = grain
trade_goods = livestock
trade_goods = fish
}
has_production_building_trigger = yes
has_manpower_building_trigger = yes
has_manufactory_trigger = yes
base_production = 7
}
add_base_production = 1
if = { limit = { has_building = training_fields } add_mil_power = 100 }
else = { remove_building = barracks add_building = training_fields }
}"
			}
			custom_tooltip = gushuokguan_1_3_effect_tt
			hidden_effect = {
				every_owned_province = {
					limit = {
						OR = {
							trade_goods = grain
							trade_goods = livestock
							trade_goods = fish
						}
						has_production_building_trigger = yes
						has_manpower_building_trigger = yes
						has_manufactory_trigger = yes
						base_production = 7
					}
					add_province_modifier = {
						name = gushuokguan_local_supplier
						duration = 18250
					}
				}
			}
		}
	}

	gushuokguan_1_4 = {
		icon = mission_sunset
		position = 4
		required_missions = { gushuokguan_1_3 } 
		provinces_to_highlight = {
			OR = {
				AND = {
					superregion = yanshen_superregion
					OR = {
						NOT = { country_or_non_sovereign_subject_holds = ROOT } #Gushuokguan
						AND = {
							country_or_non_sovereign_subject_holds = ROOT #Gushuokguan
							devastation = 0.01
							unrest = 0
						}
					}
					
				}
				AND = {
					OR = {
						province_group = golden_highway_upper_yanshen
						province_group = golden_highway_yanshen_coast
					}
					NOT = { development = 12 }
				}
			}
		} 

		trigger = {  
			yanshen_superregion = {
                type = all
                OR = {
                    country_or_non_sovereign_subject_holds = ROOT #Gushuokguan
                    is_city = no #For Aikogeoke
                }
            }
			NOT = {
				any_owned_province = {
					superregion = yanshen_superregion
					OR = {
						devastation = 0.01
						unrest = 0
					}
				}
			}
			golden_highway_upper_yanshen = {
				type = all
				development = 12
			}
			golden_highway_yanshen_coast = {
				type = all
				development = 12
			}
		} 

		effect = {  
			add_country_modifier = {
				name = gushuokguan_peace_in_our_time
				duration = -1
			}
		} 
	}

	gushuokguan_1_6 = {
		icon = mission_oirat #False error
		position = 6
		required_missions = { gushuokguan_2_5 } 
		provinces_to_highlight = {  } 

		trigger = { 
			Y96 = { #Guwaamud
				num_of_owned_provinces_with = {
					culture = shuvuush
					NOT = { unrest = 0 }
					province_has_current_tech_fort_trigger = yes
					has_manpower_building_trigger = yes
					value = 5
				}
				custom_trigger_tooltip = {
					tooltip = gushuokguan_1_6_tt
					capital_scope = {
						num_of_units_in_province = {
							who = ROOT #Gushuokguan
							type = cavalry
							amount = 20
						}
					}
				}
			}
		} 

		effect = {  
			Y96 = {
				capital_scope = {
					kill_units = {
						who = ROOT #Gushuokguan
						type = cavalry
						amount = 20
					}
				}
			}
			custom_tooltip = gushuokguan_rock_raiders_tt
			hidden_effect = {
				set_country_flag = gushuokguan_rock_raiders
			}
		} 
	}

	gushuokguan_1_7 = {
		icon = mission_underground_cave
		position = 7
		required_missions = { gushuokguan_1_6 } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_rock_raiders_battle_tt
				has_country_flag = gushuokguan_rock_raiders_battle
			}
		} 

		effect = {  
			custom_tooltip = gushuokguan_rock_raiders_tier_2_tt
			random_hired_mercenary_company = {
				limit = { template = merc_rock_raiders }
				disband_mercenary_company = THIS
			}
			hidden_effect = {
				clr_country_flag = gushuokguan_rock_raiders
				set_country_flag = gushuokguan_rock_raiders_tier_2
			}
		} 
	}

	gushuokguan_1_8 = {
		icon = mission_asian_cannon
		position = 8
		required_missions = {
			gushuokguan_2_7
		}
		provinces_to_highlight = { } 

		trigger = {  
			4901 = { #Hubao
				country_or_non_sovereign_subject_holds = ROOT #Gushuokguan
				num_of_units_in_province = {
					who = ROOT #Gushuokguan
					type = infantry
					amount = 20
				}				
				num_of_units_in_province = {
					who = ROOT #Gushuokguan
					type = artillery
					amount = 20
				}
			}
			Y03 = { #Hubao
				is_subject_of = ROOT #Gushuokguan
				NOT = { liberty_desire = 1 }
			}
			custom_trigger_tooltip = {
				tooltip = gushuokguan_4_stone_army_challenges_tt
				calc_true_if = {
					mission_completed = gushuokguan_1_7
					mission_completed = gushuokguan_2_9
					mission_completed = gushuokguan_3_7
					mission_completed = gushuokguan_3_9
					mission_completed = gushuokguan_4_7
					mission_completed = gushuokguan_4_9
					amount = 4
				}
			}
		} 

		effect = {  
			4901 = {
				kill_units = {
					who = ROOT #Gushuokguan
					type = infantry
					amount = 10
				}
				kill_units = {
					who = ROOT #Gushuokguan
					type = artillery
					amount = 10
				}
			}
			random_hired_mercenary_company = {
				limit = { template = merc_dacite_dragons }
				disband_mercenary_company = THIS
			}
			custom_tooltip = gushuokguan_dacite_dragons_tt
			hidden_effect = {
				set_country_flag = gushuokguan_dacite_dragons
				set_variable = {
					which = gushuokguan_dacite_dragons_death_toll
					which = 0
				}
			}
		} 
	}

	gushuokguan_1_9 = {
		icon = mission_necromancy
		position = 9
		required_missions = { gushuokguan_1_8 } 
		provinces_to_highlight = {  } 

		trigger = {  
			OR = {
				custom_trigger_tooltip = {
					tooltip = gushuokguan_renting_to_rending_tt
					has_global_flag = rending_active
					any_known_country = {
						OR = {
							has_country_flag = rending_ward_flag
							has_country_flag = rending_appease_flag
						}
						any_hired_mercenary_company = {
							template = merc_dacite_dragons #I hope there was another way to check army name
							location = { controller = { is_hiring_condottiere_from = ROOT } } #Gushuokguan
						}
					}
				}
				custom_trigger_tooltip = {
					tooltip = gushuokguan_defeated_spirit_rebels_tt
					check_variable = {
						which = gushuokguan_dacite_dragons_death_toll
						value = 20000
					}
				}
			}
		} 

		effect = {  
			custom_tooltip = gushuokguan_dacite_dragons_tier_2_tt
			random_hired_mercenary_company = {
				limit = { template = merc_dacite_dragons }
				disband_mercenary_company = THIS
			}
			hidden_effect = {
				clr_country_flag = gushuokguan_dacite_dragons
				set_country_flag = gushuokguan_dacite_dragons_tier_2
			}
		} 
	}
}
gushuokguan_2 = {
	slot = 2
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = Y17 } 

	gushuokguan_2_1 = {
		icon = mission_japanese_fort
		position = 1
		provinces_to_highlight = {  
			owned_by = ROOT #Gushuokguan
			OR = {
				has_fort_building_trigger = yes
				any_neighbor_province = {
					owned_by = ROOT #Gushuokguan
					has_fort_building_trigger = yes
				}
			}
			NOT = { has_tax_building_trigger = yes }
		} 

		trigger = {
			num_of_owned_provinces_with = {
				OR = {
					has_fort_building_trigger = yes
					any_neighbor_province = {
						owned_by = ROOT #Gushuokguan
						has_fort_building_trigger = yes
					}
				}
				has_tax_building_trigger = yes
				value = 10
			}
		}

		effect = {
			define_advisor = {
				type = fortification_expert
				skill = 3
				cost_multiplier = 0.25
			}
			custom_tooltip = gushuokguan_stone_forts_tt
			hidden_effect = {
				every_owned_province = {
					limit = { has_fort_building_trigger = yes } 
					add_province_modifier = {
						name = "gushuokguan_stone_forts"
						duration = -1
					}
				}
			}
		}
	}

	gushuokguan_2_2 = {
		icon = jap_financial_cliques
		position = 2
		required_missions = { gushuokguan_2_1 } 
		provinces_to_highlight = {  
			is_capital_of = ROOT #Gushuokguan
			NOT = { 
				AND = {
					base_manpower = 5 
					has_manpower_building_trigger = yes
				}
			}
		} 

		trigger = {
			custom_trigger_tooltip = {
				tooltip = gushuokguan_condottieri_stone_army_tt
				any_hired_mercenary_company = {
					template = merc_stone_army #I hope there was another way to check army name
					location = { controller = { is_hiring_condottiere_from = ROOT } } #Gushuokguan
				}
			}
			capital_scope = {
				base_manpower = 5
				has_manpower_building_trigger = yes
			}
		} 

		effect = {  
			country_event = {
				id = gushuokguan_event.3 #The Stone Swords
			}
			custom_tooltip = gushuokguan_stone_army_tier_2_tt
			random_hired_mercenary_company = {
				limit = { template = merc_stone_army } 
				disband_mercenary_company = THIS
			}
			hidden_effect = { set_country_flag = gushuokguan_stone_army_tier_2 } 
		} 
	}

	gushuokguan_2_3 = {
		icon = mng_thirteen_provinces
		position = 3
		required_missions = { gushuokguan_2_2 } 
		provinces_to_highlight = {  } 

		trigger = {
			num_of_owned_provinces_with = {
				has_manpower_building_trigger = yes
				has_forcelimit_building_trigger = yes
				value = 10
			}
		}

		effect = {  
			custom_tooltip = gushuokguan_2_3_effect_tt
			custom_tooltip = gushuokguan_can_replenish_mercenaries_tt
			hidden_effect = { 
				set_country_flag = gushuokguan_can_replenish_mercenaries 
				for = {
					amount = 10
					effect = "
						random_owned_province = {
							limit = {
								has_manpower_building_trigger = yes
								has_forcelimit_building_trigger = yes
							}
							add_province_modifier = {
								name = gushuokguan_2_3_modifier
								duration = -1
							}
						}
					"
				}
			} 
		}
	}

	gushuokguan_2_4 = {
		icon = mjz_for_the_horde
		position = 4
		required_missions = {
			gushuokguan_2_3
			gushuokguan_4_3
		}
		provinces_to_highlight = {  } 

		trigger = {  
			has_mil_advisor_3 = yes
			num_of_generals = 3
			num_of_regiments_at_full_drill = 20
			army_professionalism = 0.6
			diplomatic_reputation = 3
		} 

		effect = {  
			add_country_modifier = {
				name = gushuokguan_experts_of_warfare
				duration = -1
			}
		} 
	}

	gushuokguan_2_5 = {
		icon = spa_tercios_system
		position = 5
		required_missions = {
			gushuokguan_1_4
			gushuokguan_2_4
		}
		provinces_to_highlight = {  } 

		trigger = {  
			num_of_mercenaries = 30
			calc_true_if = {
				all_known_country = {
					NOT = { is_subject_of = ROOT } #Gushuokguan
					OR = {
						has_opinion = {
							who = ROOT #Gushuokguan
							value = 150
						}
						alliance_with = ROOT #Gushuokguan
						has_spy_network_from = {
							who = ROOT #Gushuokguan
							value = 50
						}
					}
				}
				amount = 3
			}
		} 

		effect = {  
			add_country_modifier = {
				name = gushuokguan_influx_of_foreign_men
				duration = 14600
			}
		} 
	}

	gushuokguan_2_7 = {
		icon = expand_the_swiss_guard
		position = 7
		required_missions = { gushuokguan_2_5 } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_rented_condottieri_10_times_tt
				check_variable = {
					which = gushuokguan_rented_condottieri_counter
					value = 10
				}
			}
		}

		effect = {  
			add_years_of_income = 5
			custom_tooltip = anb_cant_be_sacked_tt
			set_country_flag = anb_cant_be_sacked
		}
	}

	gushuokguan_2_8 = {
		icon = mission_alone_in_the_forest_2
		position = 8
		required_missions = { gushuokguan_2_7 } 
		provinces_to_highlight = {  
			owned_by = ROOT #Gushuokguan
			has_terrain = jungle
			NOT = {
				AND = {
					has_manpower_building_trigger = yes
					NOT = { devastation = 0.01 }
				}
			}
		} 

		trigger = {  
			num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
				has_terrain = jungle
				has_manpower_building_trigger = yes
				NOT = { devastation = 0.01 }
				value = 4
			}
			4838 = { #Wongpou
				num_of_units_in_province = {
					who = ROOT #Gushuokguan
					type = cavalry
					amount = 20
				}
			}
			custom_trigger_tooltip = {
				tooltip = gushuokguan_4_stone_army_challenges_tt
				calc_true_if = {
					mission_completed = gushuokguan_1_7
					mission_completed = gushuokguan_1_9
					mission_completed = gushuokguan_3_7
					mission_completed = gushuokguan_3_9
					mission_completed = gushuokguan_4_7
					mission_completed = gushuokguan_4_9
					amount = 4
				}
			}
		} 

		effect = {
			4838 = {
				kill_units = {
					who = ROOT #Gushuokguan
					type = infantry
					amount = 20
				}
			}
			random_hired_mercenary_company = {
				limit = { template = merc_whetstones }
				disband_mercenary_company = THIS
			}
			custom_tooltip = gushuokguan_whetstones_tt
			hidden_effect = {
				set_country_flag = gushuokguan_whetstones
			}
		}
	}

	gushuokguan_2_9 = {
		icon = mission_jungle #False error
		position = 9
		required_missions = { gushuokguan_2_8 } 
		provinces_to_highlight = {  } 

		trigger = {  
			any_known_country = {
				NOT = { is_subject_of = ROOT } #Gushuokguan
				num_of_owned_provinces_with = {
					has_terrain = jungle
					value = 3
				}
				OR = {
					is_hiring_condottiere_from = ROOT #Gushuokguan
					is_in_war = {
						attacker_leader = ROOT #Gushuokguan
					}
				}
				
			}
		} 

		effect = {  
			custom_tooltip = gushuokguan_whetstones_tier_2_tt
			random_hired_mercenary_company = {
				limit = { template = merc_whetstones }
				disband_mercenary_company = THIS
			}
			hidden_effect = {
				clr_country_flag = gushuokguan_whetstones
				set_country_flag = gushuokguan_whetstones_tier_2
			}
		}
	}
}
gushuokguan_3 = {
	slot = 3
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = Y17 } 

	gushuokguan_3_1 = {
		icon = mission_the_chola_campaigns
		position = 1
		provinces_to_highlight = { } 

		trigger = {  
			OR = {
				Y05 = { #Lanjinhui
					alliance_with = ROOT #Gushuokguan
					has_opinion = {
						who = ROOT #Gushuokguan
						value = 150
					}
				}
				AND = {
					Y05 = { #Lanjinhui
						has_90_opinion_improved_relation = { target = ROOT } #Gushuokguan
					}
					diplomatic_reputation = 2
					has_dip_advisor = yes
				}
				AND = {
					Y05 = { #Lanjinhui
						is_rival = ROOT #Gushuokguan
						has_been_insulted_by_root = yes
					}
				}
			}
		} 

		effect = {  

			custom_tooltip = gushuokguan_lanjinhui_is_ally_tt
			tooltip = { country_event = { id = gushuokguan_event.1 } } #An Alliance of Convenience
			custom_tooltip = feitenNewLine
			
			custom_tooltip = gushuokguan_lanjinhui_is_rival_tt
			tooltip = {
				country_event = {
					id = gushuokguan_event.2 #The Fools of Lanjinhui
				}
				Y05 = { #Lanjinhui
					every_owned_province = {
						add_permanent_claim = ROOT #Gushuokguan
					}
				}
			}

			hidden_effect = {
				if = {
					limit = { 
						Y05 = { 
							OR = {
								alliance_with = ROOT #Lanjinhui
								has_90_opinion_improved_relation = { target = ROOT } #Gushuokguan
							} 
						}
					}
					country_event = {
						id = gushuokguan_event.1 #An Alliance of Convenience
					}
				}
				if = {
					limit = { Y05 = { is_rival = ROOT } } #Lanjinhui
					country_event = {
						id = gushuokguan_event.2 #The Fools of Lanjinhui
					}
					Y05 = { #Lanjinhui
						every_owned_province = {
							add_permanent_claim = ROOT #Gushuokguan
						}
					}
				}
			}
		}
	}

	gushuokguan_3_2 = {
		icon = mission_confrontation
		position = 2
		required_missions = { gushuokguan_3_1 } 
		provinces_to_highlight = {  
			OR = {
				area = liuminxiang_area
				area = erluxi_area
			}
			NOT = { country_or_non_sovereign_subject_holds = ROOT } #Gushuokguan	
		} 

		trigger = {  
			OR = {
				#Case 1: Ally
				AND = {
					alliance_with = Y05 #Lanjinhui
					army_strength = {
						who = Y05 #Lanjinhui
						value = 0.5
					}
					Y05 = { #Lanjinhui
						custom_trigger_tooltip = {
							tooltip = gushuokguan_3_2_tt
							capital_scope = {
								num_of_units_in_province = {
									who = ROOT #Gushuokguan
									type = infantry
									amount = 6
								}
							}
						}
						has_spy_network_from = {
							who = ROOT #Gushuokguan
							value = 30
						}
					}
				}
				
				#Case 2: Rival
				AND = {
					is_enemy = Y05 #Lanjinhui
					Y05 = { #Lanjinhui
						has_spy_network_from = {
							who = ROOT #Gushuokguan
							value = 80
						}
						any_neighbor_province = {
							owned_by = ROOT #Gushuokguan
							num_of_units_in_province = {
								who = ROOT #Gushuokguan
								type = infantry
								amount = 6
							}
						}
					}
				}
				
				#Case 3: Vassal or doesn't exist
				AND = {
					OR = {
						NOT = { exists = Y05 } #Lanjinhui
						Y05 = { vassal_of = ROOT } #Gushuokguan
					}
					liuminxiang_area = {
						type = all
						country_or_non_sovereign_subject_holds = ROOT #Gushuokguan
					}
					erluxi_area = {
						type = all
						country_or_non_sovereign_subject_holds = ROOT #Gushuokguan
					}
				}
			}
		} 

		effect = {
			custom_tooltip = gushuokguan_lanjinhui_is_ally_tt
			tooltip = { country_event = { id = gushuokguan_event.4 }  }
			custom_tooltip = feitenNewLine

			custom_tooltip = gushuokguan_lanjinhui_is_vassal_tt
			tooltip = {
				Y05 = {
					add_country_modifier = {
						name = gushuokguan_brothers_in_freedom
						duration = 7300
					}
				}
			}
			#No need for /n since country modifier already does that

			custom_tooltip = gushuokguan_lanjinhui_is_rival_tt
			tooltip = { country_event = { id = gushuokguan_event.5 } }
			custom_tooltip = gushuokguan_incoming_war_tt
			custom_tooltip = feitenNewLine
			
			custom_tooltip = gushuokguan_lanjinhui_is_kil_tt
			tooltip = {
				create_vassal = Y05 #Lanjinhui
				add_adm_power = 100
			}
			custom_tooltip = feitenNewLine
			hidden_effect = {
				if = {
					limit = { Y05 = { alliance_with = ROOT } } #Lanjinhui #Gushuokguan
					country_event = { id = gushuokguan_event.4 } 
				}
				else_if = {
					limit = {
						Y05 = { #Lanjinhui
							vassal_of = ROOT #Gushuokguan
						}
						ai = no
					}
					Y05 = {
						add_country_modifier = {
							name = gushuokguan_brothers_in_freedom
							duration = 7300
						}
					}
				}
				else_if = {
					limit = {
						Y05 = { #Lanjinhui
							is_enemy = ROOT #Gushuokguan
						}
						ai = no
					}
					country_event = { id = gushuokguan_event.5 } 
					custom_tooltip = gushuokguan_incoming_war_tt
				}
				else_if = {
					limit = {
						NOT = { exists = Y05 } #Lanjinhui
					}
					create_vassal = Y05 #Lanjinhui
					add_adm_power = 100
				}
			}
		} 
	}

	gushuokguan_3_4 = {
		icon = mng_jing_hang_grand_canal
		position = 4
		required_missions = { gushuokguan_4_3 } 
		provinces_to_highlight = {  
			OR = {
				area = linyuan_area
				area = yanzhong_area
				area = anjiang_area
				area = tianszi_area
			}
			owned_by = ROOT #Gushuokguan
			OR = {
				NOT = {
					local_autonomy = 25
					has_province_modifier = autonomy_increased
				}
				devastation = 0.01
				unrest = 0
				AND = {
					ROOT = { has_parliament = yes } #Gushuokguan
					has_seat_in_parliament = no
				}
			}
		} 

		trigger = {
			custom_trigger_tooltip = {
				tooltip = gushuokguan_3_4_trigger_tt
				linyuan_area = {
					type = all
					owned_by = ROOT #Gushuokguan
					OR = {
						local_autonomy = 25
						has_province_modifier = autonomy_increased
					}
					NOT = { devastation = 0.01 }
					NOT = { unrest = 0 }
					OR = {
						ROOT = { has_parliament = no } #Gushuokguan
						has_seat_in_parliament = yes
					}
				}
				yanzhong_area = {
					type = all
					owned_by = ROOT #Gushuokguan
					OR = {
						local_autonomy = 25
						has_province_modifier = autonomy_increased
					}
					NOT = { devastation = 0.01 }
					NOT = { unrest = 0 }
					OR = {
						ROOT = { has_parliament = no } #Gushuokguan
						has_seat_in_parliament = yes
					}
				}
				anjiang_area = {
					type = all
					owned_by = ROOT #Gushuokguan
					OR = {
						local_autonomy = 25
						has_province_modifier = autonomy_increased
					}
					NOT = { devastation = 0.01 }
					NOT = { unrest = 0 }
					OR = {
						ROOT = { has_parliament = no } #Gushuokguan
						has_seat_in_parliament = yes
					}
				}
				tianszi_area = {
					type = all
					owned_by = ROOT #Gushuokguan
					OR = {
						local_autonomy = 25
						has_province_modifier = autonomy_increased
					}
					NOT = { devastation = 0.01 }
					NOT = { unrest = 0 }
					OR = {
						ROOT = { has_parliament = no } #Gushuokguan
						has_seat_in_parliament = yes
					}
				}
			}
		}

		effect = {
			hidden_effect = { 
				set_country_flag = gushuokguan_can_release_hubao 
				every_owned_province = {
					limit = {
						OR = {
							area = yanzhong_area
							area = balrijin_area
							area = tianszi_area
							area = anjiang_area
							area = linyuan_area
						}
					}
					cede_province = V19 #Yanszin
					add_core = V19 #Yanszin
				}
			} 
			create_subject = {
				subject_type = dao
				subject = V19 #Yanszin
			}
			custom_tooltip = gushuokguan_release_yanszin_tt
			custom_tooltip = feitenNewLine
			add_mil_power = 50
			add_country_modifier = {
				name = gushuokguan_trade_power_of_the_yan
				duration = 7300
			}
			custom_tooltip = gushuokguan_can_release_hubao_tt
		}
	}

	gushuokguan_3_6 = {
		icon = mission_harimar
		position = 6
		required_missions = { gushuokguan_2_5 } 
		provinces_to_highlight = { } 

		trigger = {  
			high_tolerance_harimari_race_trigger = yes
			accepted_culture = serene_harimari
			4925 = { #Jiantsiang
				num_of_units_in_province = {
					who = ROOT #Gushuokguan
					type = infantry
					amount = 20
				}
				NOT = { unrest = 0 }
				has_tax_building_trigger = yes
				has_production_building_trigger = yes
			}
		} 

		effect = { 
			4925 = {
				kill_units = {
					who = ROOT #Gushuokguan
					type = infantry
					amount = 20
				}
			} 
			custom_tooltip = gushuokguan_chrome_claws_tt
			hidden_effect = {
				set_country_flag = gushuokguan_chrome_claws
			}
		}
	}

	gushuokguan_3_7 = {
		icon = mission_conquer_bengal_dlh
		position = 7
		required_missions = { gushuokguan_3_6 } 
		provinces_to_highlight = {  
			owner = {
				culture_is_harimari = yes
				NOT = {
					AND = {
						has_opinion = {
							who = ROOT #Gushuokguan
							value = 150
						}
						trust = {
							who = ROOT #Gushuokguan
							value = 80
						}
						is_hiring_condottiere_from = ROOT #Gushuokguan
						any_hired_mercenary_company = {
							template = merc_chrome_claws
						}
					}
				}
			}
		} 

		trigger = {  
			any_known_country = {
				is_hiring_condottiere_from = ROOT #Gushuokguan
				culture_is_harimari = yes
				has_opinion = {
					who = ROOT #Gushuokguan
					value = 150
				}
				trust = {
					who = ROOT #Gushuokguan
					value = 80
				}
			}
		} 

		effect = {
			4914 = { add_harimari_minority_size_effect = yes } #Gushibi
			custom_tooltip = gushuokguan_chrome_claws_tier_2_tt
			random_hired_mercenary_company = {
				limit = { template = merc_chrome_claws }
				disband_mercenary_company = THIS
			}
			hidden_effect = {
				clr_country_flag = gushuokguan_chrome_claws
				set_country_flag = gushuokguan_chrome_claws_tier_2
			}
		}
	}

	gushuokguan_3_8 = {
		icon = qng_modernize_the_banners
		position = 8
		required_missions = { gushuokguan_2_7 } 
		provinces_to_highlight = { } 

		trigger = {  
			V19 = { #Yanszin
				is_subject_of = ROOT #Gushuokguan
				NOT = { liberty_desire = 1 }
			}
			4853 = { #Anjiang
				num_of_units_in_province = {
					who = ROOT #Gushuokguan
					type = cavalry
					amount = 20
				}
				has_production_building_trigger = yes
				has_manpower_building_trigger = yes
			}
			custom_trigger_tooltip = {
				tooltip = gushuokguan_2_stone_army_challenges_tt
				calc_true_if = {
					mission_completed = gushuokguan_1_7
					mission_completed = gushuokguan_1_9
					mission_completed = gushuokguan_2_9
					mission_completed = gushuokguan_3_7
					mission_completed = gushuokguan_4_7
					mission_completed = gushuokguan_4_9
					amount = 2
				}
			}
		} 

		effect = {  
			4853 = { #Anjiang
				kill_units = {
					who = ROOT #Gushuokguan
					type = cavalry
					amount = 20
				}
			}
			random_hired_mercenary_company = {
				limit = { template = merc_marble_mounts }
				disband_mercenary_company = THIS
			}
			custom_tooltip = gushuokguan_marble_mounts_tt
			hidden_effect = {
				set_country_flag = gushuokguan_marble_mounts
			}
		} 
	}

	gushuokguan_3_9 = {
		icon = mission_war_chest
		position = 9
		required_missions = { gushuokguan_3_8 } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_won_100_battles_tt
				check_variable = {
					which = gushuokguan_battle_counter
					value = 100
				}
			}
		} 

		effect = {  
			custom_tooltip = gushuokguan_marble_mounts_tier_2_tt
			random_hired_mercenary_company = {
				limit = { template = merc_marble_mounts }
				disband_mercenary_company = THIS
			}
			hidden_effect = {
				clr_country_flag = gushuokguan_marble_mounts
				set_country_flag = gushuokguan_marble_mounts_tier_2
			}
		}
	}
}
gushuokguan_4 = {
	slot = 4
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = Y17 } 

	gushuokguan_4_1 = {
		icon = mission_scholar_officials
		position = 1
		provinces_to_highlight = {  } 

		trigger = {
			estate_loyalty = {
				estate = estate_eunuchs_anb
				loyalty = 60
			}
			estate_loyalty = {
				estate = estate_adventurers
				loyalty = 60
			}
			estate_loyalty = {
				estate = estate_burghers
				loyalty = 60
			}
			estate_influence = {
				estate = estate_eunuchs_anb
				influence = 50
			}
			estate_influence = {
				estate = estate_adventurers
				influence = 30
			}
			estate_influence = {
				estate = estate_burghers
				influence = 50
			}
		}

		effect = {  
			add_country_modifier = {
				name = gushuokguan_writing_a_new_oath
				duration = 1825
			}
			hidden_effect = {
				country_event = {
					id = gushuokguan_event.6 #The Triple Alliance
					days = 1825
				}
			}
		} 
	}

	gushuokguan_4_2 = {
		icon = per_build_the_fire_temples
		position = 2
		required_missions = {
			gushuokguan_4_1
			gushuokguan_5_1
		}
		provinces_to_highlight = {  
			OR = {
				#Case 1: Gushuokguan Core
				AND = {
					OR = {
						area = xuanbing_area
						province_id = 4927 #Shiying
						province_id = 4917 #Jiangchang
						province_id = 4980 #Tsianjian
					}
					NOT = { 
						AND = {
							is_core = ROOT #Gushuokguan
							has_production_building_trigger = yes
							has_tax_building_trigger = yes
						}
					}
				}
				#Case 2: Zhiqian exists
				owned_by = Y14 #Zhiqian
			}
		} 

		trigger = { 
			estate_loyalty = {
				estate = estate_burghers
				loyalty = 60
			}
			NOT = { exists = Y14 } #Zhiqian 
			xuanbing_area = {
				type = all
				is_core = ROOT #Gushuokguan
				has_production_building_trigger = yes
				has_tax_building_trigger = yes
			}
			4927 = { #Shiying
				is_core = ROOT #Gushuokguan
				has_production_building_trigger = yes
				has_tax_building_trigger = yes
			}
			4917 = { #Jiangchang
				is_core = ROOT #Gushuokguan
				has_production_building_trigger = yes
				has_tax_building_trigger = yes
			}
			4980 = { #Tsianjian
				is_core = ROOT #Gushuokguan
				has_production_building_trigger = yes
				has_tax_building_trigger = yes
			}
		} 

		effect = {  
			jiantsiang_area = {
				add_permanent_claim = ROOT #Gushuokguan
			}
			tianlou_area = {
				add_permanent_claim = ROOT #Gushuokguan
			}
			jinjiang_area = {
				add_permanent_claim = ROOT #Gushuokguan
			}
			yiguan_area = {
				add_permanent_claim = ROOT #Gushuokguan
			}
			xuanbing_area = {
				add_province_modifier = {
					name = gushuokguan_liberation_of_our_kin
					duration = 3650
				}
			}
			4927 = { #Shiying
				add_province_modifier = {
					name = gushuokguan_liberation_of_our_kin
					duration = 3650
				}
			}
			4917 = { #Jiangchang
				add_province_modifier = {
					name = gushuokguan_liberation_of_our_kin
					duration = 3650
				}
			}
			4980 = { #Tsianjian
				add_province_modifier = {
					name = gushuokguan_liberation_of_our_kin
					duration = 3650
				}
			}
		}
	}

	gushuokguan_4_3 = {
		icon = mng_deal_kama_kagyu
		position = 3
		required_missions = {
			gushuokguan_3_2
			gushuokguan_4_2
		}
		provinces_to_highlight = {  
			OR = {
				#Case 1: Areas you need to own
				AND = {
					OR = {
						area = tianlou_area
						area = jinjiang_area
					}
					NOT = { country_or_non_sovereign_subject_holds = ROOT } #Gushuokguan
				}
				#Case 2: Areas you need to core
				AND = {
					region = north_yanshen_region
					culture = jiangyang
					OR = {
						NOT = { owned_by = ROOT } #Gushuokguan
						AND = {
							owned_by = ROOT #Gushuokguan
							OR = {
								NOT = {
									local_autonomy = 25
									has_province_modifier = autonomy_increased
									is_capital = yes
								}
								devastation = 0.01
								unrest = 0
								AND = {
									ROOT = { has_parliament = yes } #Gushuokguan
									has_seat_in_parliament = no
								}
							}
						}
					}
					
				}
			}
		} 

		trigger = {  
			tianlou_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT #Gushuokguan
			}
			jinjiang_area = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT #Gushuokguan
			}
			custom_trigger_tooltip = {
				tooltip = gushuokguan_4_3_trigger_tt
				north_yanshen_region = {
					type = all
					OR = {
						AND = {
							culture = jiangyang
							is_core = ROOT #Gushuokguan
							OR = {
								local_autonomy = 25
								has_province_modifier = autonomy_increased
								is_capital = yes
							}
							NOT = { devastation = 0.01 } 
							NOT = { unrest = 0 }
							OR = {
								ROOT = { has_parliament = no } #Gushuokguan
								has_seat_in_parliament = yes 
							}
						}
						NOT = { culture = jiangyang }
					}
				}
			}

			
		}

		effect = {  
			country_event = {
				id = gushuokguan_event.7
			}
			custom_tooltip = gushuokguan_can_release_guwaamud_tt
			hidden_effect = {
				set_country_flag = gushuokguan_can_release_guwaamud
			}
		} 
	}

	gushuokguan_4_4 = {
		icon = mission_tianlou
		position = 4
		required_missions = { gushuokguan_4_3 } 
		provinces_to_highlight = {  
			area = iongsim_area
			owned_by = ROOT #Gushuokguan
			OR = {
				NOT = {
					local_autonomy = 25
					has_province_modifier = autonomy_increased
					is_capital = yes
				}
				devastation = 0.01
				unrest = 0
				AND = {
					ROOT = { has_parliament = yes } #Gushuokguan
					has_seat_in_parliament = no
				}
			}
		} 

		trigger = {
			NOT = { exists = Y20 } #Feiten
			iongsim_area = {
				type = all
				is_core = ROOT #Gushuokguan
				owned_by = ROOT #Gushuokguan
				OR = {
					local_autonomy = 25
					has_province_modifier = autonomy_increased
				}
				NOT = { devastation = 0.01 }
				NOT = { unrest = 0 }
				OR = {
					ROOT = { has_parliament = no } #Gushuokguan
					has_seat_in_parliament = yes
				}
			}
		} 

		effect = {  
			hidden_effect = { #hidden effect goes first so that create subject works properly
				set_country_flag = gushuokguan_can_release_zyujyut
				every_owned_province = {
					limit = {
						OR = {
							area = iongsim_area
							area = luoyip_area
							area = hongnguan_area
							area = gungi_area
							area = xiyun_area
						}
					}
					cede_province = Y20 #Feiten
					add_core = Y20 #Feiten
				}
			} 
			create_subject = {
				subject_type = dao
				subject = Y20 #Feiten
			}
			custom_tooltip = gushuokguan_release_feiten_tt
			4871 = { #Tianlou
				add_unit_construction = {
					type = light_ship
					cost = 0
					speed = 0.5
					amount = 10
				}
			}
			custom_tooltip = gushuokguan_can_release_zyujyut_tt
		}
	}

	gushuokguan_4_5 = {
		icon = mission_rice_farming
		position = 5
		required_missions = {
			gushuokguan_3_4
			gushuokguan_4_4
			gushuokguan_5_4
		}
		provinces_to_highlight = { } 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_50_vassal_provinces_tt
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					owned_by_subject_of = ROOT #Gushuokguan
					development = 10
					NOT = { devastation = 0.01 } 
					num_of_buildings_in_province = 3
					NOT = { unrest = 0 }
					value = 50
				}
			}
		} 

		effect = {  
			custom_tooltip = gushuokguan_4_5_effect_tt
			add_country_modifier = {
				name = gushuokguan_the_caring_leader
				duration = -1
			}
			hidden_effect = {
				every_subject_country = {
					every_owned_province = {
						limit = {
							development = 10
							NOT = { devastation = 0.01 } 
							num_of_buildings_in_province = 3
						}
						add_province_modifier = {
							name = gushuokguan_confederal_mercantilism
							duration = 18250
						}
					}
				}
			}
		} 
	}

	gushuokguan_4_6 = {
		icon = jap_kirishtan_realm
		position = 6
		required_missions = { gushuokguan_2_5 } 
		provinces_to_highlight = {  } 

		trigger = {  
			num_of_mercenaries = 100 #Average Lategame mission
		} 

		effect = { country_event = { id = gushuokguan_event.17 } } #Seven Swords Society
	}

	gushuokguan_4_7 = {
		icon = mng_shengshi_zhishi
		position = 7
		required_missions = { gushuokguan_4_6 } 
		provinces_to_highlight = {  } 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_jade_pub_incident_tt
				has_country_flag = gushuokguan_jade_pub_incident
			}
			custom_trigger_tooltip = {
				tooltip = gushuokguan_6_stone_army_challenges_tt
				calc_true_if = {
					mission_completed = gushuokguan_1_7
					mission_completed = gushuokguan_1_9
					mission_completed = gushuokguan_2_9
					mission_completed = gushuokguan_3_7
					mission_completed = gushuokguan_3_9
					mission_completed = gushuokguan_4_9
					amount = 6
				}
			}
		} 

		effect = { 
			country_event = { id = gushuokguan_event.19 } 
			hidden_effect = {
				clr_country_flag = gushuokguan_jade_pub_incident
			}
		}
	}

	gushuokguan_4_8 = {
		icon = mission_balloon
		position = 8
		required_missions = { gushuokguan_2_7 } 
		provinces_to_highlight = { } 

		trigger = {  
			Y20 = { #Feiten
				is_subject_of = ROOT #Gushuokguan
				NOT = { liberty_desire = 1 }
			}
			4879 = { #Feiten
				has_fort_building_trigger = yes
				has_shipyard_building_trigger = yes
				has_dock_building_trigger = yes
				has_building = impressment_offices
				num_of_units_in_province = {
					who = ROOT #Gushuokguan
					type = infantry
					amount = 10
				}
				num_of_units_in_province = {
					who = ROOT #Gushuokguan
					type = artillery
					amount = 10
				}
			}
		} 

		effect = {  
			4879 = { #Feiten
				kill_units = {
					who = ROOT #Gushuokguan
					type = infantry
					amount = 10
				}
				kill_units = {
					who = ROOT #Gushuokguan
					type = artillery
					amount = 10
				}
			}
			random_hired_mercenary_company = {
				limit = { template = merc_flying_pebbles }
				disband_mercenary_company = THIS
			}
			custom_tooltip = gushuokguan_flying_pebbles_tt
			hidden_effect = {
				set_country_flag = gushuokguan_flying_pebbles
			}
		}
	}

	gushuokguan_4_9 = {
		icon = mission_steppe_warriors
		position = 9
		required_missions = { gushuokguan_4_8 } 
		provinces_to_highlight = { } 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_won_10_sieges_tt
				check_variable = {
					which = gushuokguan_siege_counter
					value = 10
				}
			}
			custom_trigger_tooltip = {
				tooltip = gushuokguan_scorched_20_provinces_tt
				check_variable = {
					which = gushuokguan_scorched_earth_counter
					value = 20
				}
			}
		} 

		effect = {  
			custom_tooltip = gushuokguan_flying_pebbles_tier_2_tt
			random_hired_mercenary_company = {
				limit = { template = merc_flying_pebbles }
				disband_mercenary_company = THIS
			}
			hidden_effect = {
				clr_country_flag = gushuokguan_flying_pebbles
				set_country_flag = gushuokguan_flying_pebbles_tier_2
			}
		} 
	}
}
gushuokguan_5 = {
	slot = 5
	generic = no
	ai = yes
	has_country_shield = yes
	potential = { tag = Y17 } 

	gushuokguan_5_1 = {
		icon = mission_armoury
		position = 1
		provinces_to_highlight = {  } 

		trigger = {  
			any_hired_mercenary_company = { 
				template = merc_stone_army
			}
		} 

		effect = {  
			add_country_modifier = {
				name = gushuokguan_guardians_of_the_stone_state
				duration = 7300
			}
			add_country_modifier = {
				name = gushuokguan_home_of_the_stone_army
				duration = -1
			}
		} 
	}

	gushuokguan_5_2 = {
		icon = mission_accomodate_the_rajputs
		position = 2
		required_missions = { gushuokguan_5_1 } 
		provinces_to_highlight = {  
			owner = {
				OR = {
					war_with = R62 #The Command
					capital_scope = {
						region = shamakhad_region
					}
				}
				NOT = { is_hiring_condottiere_from = ROOT } #Gushuokguan
			}
		} 

		trigger = {
			any_known_country = {
				NOT = { tag = R62 } #The Command
				OR = {
					war_with = R62 #The Command
					capital_scope = {
						region = shamakhad_region
					}
				}
				is_hiring_condottiere_from = ROOT #Gushuokguan
			}
		} 

		effect = {  
			4914 = { #Gushibi
				add_hobgoblin_minority_size_effect = yes
				add_base_manpower = 2
			}
			add_army_tradition = 20
			xuanbing_area = {
				add_permanent_claim = ROOT #Gushuokguan
			}
			4980 = { #Tsianjian
				add_permanent_claim = ROOT #Gushuokguan
			}
			4927 = { #Shiying
				add_permanent_claim = ROOT #Gushuokguan
			}
			4917 = { #Jiangchang
				add_permanent_claim = ROOT #Gushuokguan
			}
		}
		
	}

	gushuokguan_5_3 = {
		icon = mission_swiss_mercenaries_flipped
		position = 3
		required_missions = { gushuokguan_4_2 } 
		provinces_to_highlight = {  } 

		trigger = {
			num_of_estate_privileges = {
				estate = estate_adventurers
				value = 3
			}
			OR = {
				AND = {
					army_tradition = 50
					if = {
						limit = { has_country_flag = gushuokguan_stone_army_tier_2 } 
						any_hired_mercenary_company = { template = merc_stone_army_tier_2 } 
					}
					else = { any_hired_mercenary_company = { template = merc_stone_army }  } 
					mil_power = 200
				}
				custom_trigger_tooltip = {
					tooltip = gushuokguan_completed_mercenary_ideas_tt
					has_idea = organised_mercenary_recruitment
				}
			}
		}

		effect = { 
			if = { limit = { has_idea = organised_mercenary_recruitment } } #Empty
			else = { add_mil_power = -200 }
			country_event = { id = gushuokguan_event.8 }
		} 
	}

	gushuokguan_5_4 = {
		icon = mng_form_depots
		position = 4
		required_missions = {
			gushuokguan_4_3
			gushuokguan_5_3
		}
		provinces_to_highlight = { } 

		trigger = {
			custom_trigger_tooltip = {
				tooltip = gushuokguan_25_vassal_provinces_tt
				num_of_provinces_owned_or_owned_by_non_sovereign_subjects_with = {
					owned_by_subject_of = ROOT #Gushuokguan
					development = 10
					NOT = { devastation = 0.01 } 
					num_of_buildings_in_province = 3
					value = 25
				}
			}			
		}

		effect = {
			custom_tooltip = gushuokguan_5_4_effect_tt
			every_subject_country = {
				hidden_effect = {
					every_owned_province = {
						limit = {
							development = 10
							NOT = { devastation = 0.01 } 
							num_of_buildings_in_province = 3
						}
						add_province_modifier = {
							name = gushuokguan_interconfederal_industries_local
							duration = 18250
						}
					}
				}
				add_country_modifier = {
					name = gushuokguan_interconfederal_industries_global
					duration = 18250
				}
				add_trust = {
					who = ROOT #Gushuokguan
					value = 50
					mutual = yes
				}
			}
		}
	}

	gushuokguan_5_5 = {
		icon = jap_strengthen_bakuhan_system
		position = 5
		required_missions = { gushuokguan_5_4 } 
		provinces_to_highlight = {  
			owner = {
				is_subject_of = ROOT #Gushuokguan
				NOT = {
					AND = {
						total_development = 150
						NOT = { liberty_desire = 10 }
						has_opinion = {
							who = ROOT #Gushuokguan
							value = 200
						}
						trust = {
							who = ROOT #Gushuokguan
							value = 90
						}
					}
				}
			}
		} 

		trigger = {  
			all_subject_country = {
				total_development = 150
				NOT = { liberty_desire = 10 }
				has_opinion = {
					who = ROOT #Gushuokguan
					value = 200
				}
				trust = {
					who = ROOT #Gushuokguan
					value = 90
				}
			}
		}

		effect = {  
			country_event = {
				id = gushuokguan_event.9 #Confederal Council
			}
		} 
	}

	gushuokguan_5_6 = {
		icon = jap_balance_shinokosho
		position = 6
		required_missions = {
			gushuokguan_2_5
			gushuokguan_4_5
			gushuokguan_5_5
		}
		provinces_to_highlight = {  
			superregion = yanshen_superregion
			NOT = {
				AND = {
					country_or_non_sovereign_subject_holds = ROOT #Gushuokguan
					NOT = { devastation = 0.01 }
				}
			}
		}

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_had_5_events_tt
				check_variable = {
					which = gushuokguan_event_counter
					value = 5
				}
			}
			army_size_percentage = 0.8
			AND = {
				Y03 = { is_subject_of = ROOT } #Hubao #Gushuokguan
				V19 = { is_subject_of = ROOT } #Yanszin #Gushuokguan
				Y23 = { is_subject_of = ROOT } #Zyujyut #Gushuokguan
				Y96 = { is_subject_of = ROOT } #Guwaamud #Gushuokguan
			}
			yanshen_superregion = {
				type = all
				country_or_non_sovereign_subject_holds = ROOT #Gushokguan
				NOT = { devastation = 0.01 }
			}
		}

		effect = {  
			country_event = {
				id = gushuokguan_event.31
			}
		} 
	}

	gushuokguan_5_7 = {
		icon = mission_unite_the_deccan
		position = 7
		required_missions = { gushuokguan_5_6 } 
		provinces_to_highlight = { 
			OR = {
				owned_by = ROOT #Gushuokguan
				owned_by_subject_of = ROOT #Gushuokguan
			}
			OR = {
				AND = {
					is_capital = yes
					NOT = { 
						AND = {
							development = 30 
							has_building = state_house
						}
					}
				}
				AND = {
					province_group = trade_node_provinces
					NOT = { 
						AND = {
							province_has_center_of_trade_of_level = 2
							has_trade_building_trigger = yes
						} 
					}
				}
			} 
		} 

		trigger = {  
			custom_trigger_tooltip = {
				tooltip = gushuokguan_civil_war_ended_tt
				OR = {
					has_country_flag = gushuokguan_civil_war_federalist_won
					has_country_flag = gushuokguan_civil_war_confederalist_won
				}
			}
			all_owned_province = {
				OR = {
					local_autonomy = 25
					has_province_modifier = autonomy_increased
				}
				NOT = { unrest = 0 }
			}
			custom_trigger_tooltip = {
				tooltip = gushuokguan_5_7_tt
				NOT = {
					trade_node_provinces = {
						country_or_subject_holds = ROOT #Gushuokguan
						OR = {
							NOT = { province_has_center_of_trade_of_level = 2 }
							NOT = { has_trade_building_trigger = yes }
						}
					}
				}
		    }
			capital_scope = {
				development = 30
				has_building = state_house
			}
			all_subject_country = {
				all_owned_province = {
					OR = {
						local_autonomy = 25
						has_province_modifier = autonomy_increased
					}
					NOT = { unrest = 0 }
				}
				capital_scope = {
					development = 30
					has_building = state_house
				}
			}
			adm_power = 300
			dip_power = 300
			mil_power = 300
			government_reform_progress = 100
		} 

		effect = {  
			add_adm_power = -300
			add_dip_power = -300
			add_mil_power = -300
			change_government_reform_progress = -100
			custom_tooltip = feitenNewLine
			xianjie_region = {
				add_permanent_claim = ROOT #Gushuokguan
			}
			custom_tooltip = gushuokguan_can_release_one_xia_tt
			custom_tooltip = feitenNewLine
			
			custom_tooltip = gushuokguan_inked_shields_win_tt
			tooltip = {
				override_country_name = "Federation of Yanshen"
				remove_country_modifier = gushuokguan_dao_normal_buff
				add_country_modifier = {
					name = gushuokguan_dao_upgraded_buff
					duration = -1
				}
				add_country_modifier = {
					name = gushuokguan_dao_republican_tradition_buff
					duration = -1
				}
				custom_tooltip = gushuokguan_dao_republican_tradition_buff_tt
			}
			custom_tooltip = feitenNewLine

			custom_tooltip = gushuokguan_red_scarfs_win_tt
			#No second tooltip, because it's just a flag so we can do it in one
			
			hidden_effect = {
				if = {
					limit = { has_country_flag = gushuokguan_civil_war_federalist_won }
					override_country_name = "Federation of Yanshen"
					remove_country_modifier = gushuokguan_dao_normal_buff
					add_country_modifier = {
						name = gushuokguan_dao_upgraded_buff
						duration = -1
					}
					add_country_modifier = {
						name = gushuokguan_dao_republican_tradition_buff
						duration = -1
					}
					every_subject_country = {
						limit = { is_subject_of_type = dao }
						ROOT = { #Gushuokguan
							create_subject = {
								subject_type = vassal
								subject = PREV
							}
						}
						add_country_modifier = {
							name = gushuokguan_dao_republican_tradition_buff
							duration = -1
						}
					}
				}
				if = {
					limit = { has_country_flag = gushuokguan_civil_war_confederalist_won }
					set_country_flag = gushuokguan_dao_diplomatic_relations
				}
				set_country_flag = gushuokguan_can_release_one_xia
			}
		} 
	}
}
